--Crear un tablespace llamado "mid_term", este solamente tendr� un datafile de 50Mb.

CREATE TABLESPACE MID_TERM
DATAFILE 'DATAFILE_MID_TERM' SIZE 50M;

--Crear un perfil que permita 5 intentos err�neos para el logueo y que tenga un idle time de 10 minutos. El nombre del perfil ser� parcial
CREATE PROFILE PARCIAL LIMIT
SESSIONS_PER_USER 5
CONNECT_TIME 50
IDLE_TIME 10;


--Crear un usuario con espacio ilimitado en el tablespace "mid_term",
--el nombre de usuario ser� la inicial de su nombre y el primer apellido completo (Ejemplo: amartinez). El perfil para este usuario ser� "parcial"
alter session set "_ORACLE_SCRIPT"=true; 

CREATE USER KGARCIA 
IDENTIFIED BY clave
DEFAULT TABLESPACE MID_TERM
QUOTA 50M ON MID_TERM;
GRANT CREATE SESSION TO KGARCIA; ---- Permissos para niciar Sessi�n

-- Permisos para la BD
GRANT DBA TO KGARCIA; 

--SE asigna el perfil al usuario creado.
ALTER USER KGARCIA PROFILE PARCIAL;

--Crear un usuario sin espacio en el tablespace "mid_term". El perfil para este usuario ser� "parcial"

CREATE USER ANDRES LIMIT
IDENTIFIED BY 0000
DEFAULT TABLESPACE MID_TERM
QUOTA 50M ON MID_TERM;
GRANT CREATE SESSION TO ANDRES;

--SE asigna el perfil al usuario creado.
ALTER USER ANDRES PROFILE PARCIAL;

--Crear 2 roles:
--El primer role se llamar� "MINI_DBA" y este tendr� los privilegios crear tablas y crear vistas.

CREATE ROLE MINI_DBA
GRANT CREATE ANY TABLE,  CREATE ANY VIEW TO MINI_DBA;

--El segundo role se llamar� "STUDENT" y este tendr� el privilegio de crear sesi�n y tendr� �nicamente acceso a las vistas que se pedir�n m�s abajo.

CREATE ROLE STUDENT
GRANT CREATE SESSION TO KGARCIA; 

-- Asociar el role MINI_DBA al primer usuario creado.
GRANT MINI_DBA TO KGARCIA;


-- Crear las tablas
CREATE TABLE ESTADOS_PRESTADORES (
  ID NUMBER(22,0) DEFAULT
  NOMBRE VARCHAR2(255 BYTE) DEFAULT
  CONSTRAINT "PRESTADORES_ID_FK" FOREIGN KEY ("PRESTADORES_ID")
);


CREATE TABLE MODALIDADES (
  ID NUMBER(22,0) DEFAULT
  NOMBRE VARCHAR2(255 BYTE)DEFAULT
);

CREATE TABLE TIPO_COMUNAS (
  ID NUMBER(22,0) DEFAULT
  TIPO VARCHAR2(255 BYTE)DEFAULT
  CONSTRAINT "COMUNAS_ID_FK" FOREIGN KEY ("COMUNAS_ID")
);

CREATE TABLE COMUNAS (
  ID NUMBER(22,0) DEFAULT
  NOMBRE VARCHAR2(255 BYTE)DEFAULT
  TIPO_COMUNA_ID VARCHAR2(255 BYTE))
  CONSTRAINT "BARRIOS_ID_FK" FOREIGN KEY ("BARRIOS_ID")
);

CREATE TABLE BARRIOS(
  ID NUMBER(22,0) DEFAULT
  NOMBRE VARCHAR2(255 BYTE) DEFAULT
  COMUNA_ID NUMBER(22,0) DEFAULT
  CONSTRAINT "SEDES_ID_FK" FOREIGN KEY ("SEDES_ID")
);

CREATE TABLE PRESTADORES(
  ID NUMBER(22,0) DEFAULT
  NOMBRE VARCHAR2(255 BYTE) DEFAULT
  FECHA_CONTRATACION DATE NOT NULL
  VALOR_CONTRATO NUMBER(19,2) DEFAULT
  ESTADO_ID NUMBER(22,0) DEFAULT
  CONSTRAINT "SEDES_ID_FK" FOREIGN KEY ("SEDES_ID")
);

CREATE TABLE SEDES(
  ID NUMBER(22,0) DEFAULT
  SEDE VARCHAR2(255 BYTE) DEFAULT
  TELEFONO  VARCHAR2(255 BYTE) DEFAULT
  DIRECCION  VARCHAR2(255 BYTE) DEFAULT
  CUPOS_DISPUESTOS NUMBER(22,0) DEFAULT
  BARRIO_ID NUMBER(22,0) DEFAULT
  MODALIDAD_ID NUMBER(22,0) DEFAULT
  PRESTADOR_ID NUMBER(22,0) DEFAULT
  CONSTRAINT "MODALIDADES_ID_FK" FOREIGN KEY ("MODALIDADES_ID")
  CONSTRAINT "PRESTACIONES_ID_FK" FOREIGN KEY ("PRESTACIONES_ID")
  CONSTRAINT "BARRIOS_ID_FK" FOREIGN KEY ("BARRIOS_ID")
);
